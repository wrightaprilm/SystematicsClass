<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phylogenetic Comparative Methods for Paleobiology • SystematicsClass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Phylogenetic Comparative Methods for Paleobiology">
<meta property="og:description" content="SystematicsClass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">SystematicsClass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/00_Basics_of_R/index.html">R Reminder</a>
    </li>
    <li>
      <a href="../../articles/01_homology_assignment/index.html">Morphological Homology Assignment</a>
    </li>
    <li>
      <a href="../../articles/02_molecular_homology/index.html">Molecular Homology Assignment</a>
    </li>
    <li>
      <a href="../../articles/03_massive_homology/index.html">Genome-Scale Homology</a>
    </li>
    <li>
      <a href="../../articles/04_ParsimonyAndModels/index.html">PAUP, parsimony, and nucletoide substitution models</a>
    </li>
    <li>
      <a href="../../articles/05_CTMC/index.html">Nucleotide substitution models</a>
    </li>
    <li>
      <a href="../../articles/05_models/index.html">Nucleotide substitution models</a>
    </li>
    <li>
      <a href="../../articles/06_Bayes_and_MCMC/index.html">Introduction to MCMC using RevBayes</a>
    </li>
    <li>
      <a href="../../articles/07_Discrete_Morphology/index.html">Discrete morphology - Models and Tree Inference</a>
    </li>
    <li>
      <a href="../../articles/08_Partitioned_data/index.html">Partitioned data analysis</a>
    </li>
    <li>
      <a href="../../articles/08_final/index.html">Final Project</a>
    </li>
    <li>
      <a href="../../articles/09_Molecular_Clock/index.html">Tripartite Model 2 - Clock Models for Character Data</a>
    </li>
    <li>
      <a href="../../articles/10_FBD/RB_Total_Evidence_Tutorial.html">RevBayes Total Evidence Tree Estimation</a>
    </li>
    <li>
      <a href="../../articles/12_Comparative_Methods/index.html">Phylogenetic Comparative Methods for Paleobiology</a>
    </li>
    <li>
      <a href="../../articles/13_biogeography/index.html">Introduction to Phylogenetic Models of Discrete Biogeography</a>
    </li>
    <li>
      <a href="../../articles/14_Final/index.html">FinalExam</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="index_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Phylogenetic Comparative Methods for Paleobiology</h1>
                        <h4 class="author">Laura C. Soul, David F. Wright</h4>
            
      
      
      <div class="hidden name"><code>index.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><strong>What is a PCM?</strong> The approaches we have been using so far today are focussed on phylogenetic inference, i.e. on estimating the most probable evolutionary relationships between taxa. One of the advantages of a framework that incorporates explicit models of diversification, is that it allows joint inference of various parameters that have traditionally been of interest to paleobiologists, like the rate of origination and extinction through time. As you have seen, it is possible to extract these estimated rates from the output of the analysis. These kinds of approaches - where we model the generating processes of diversification and character change together - can be referred to as process-based (<span class="citation">Heath, Huelsenbeck, and Stadler (2014)</span>, <span class="citation">Gavryushkina et al. (2014)</span>). Other types of information (for example biogeography; see <span class="citation">Landis and Schraiber (2017)</span>) can also be used in this modelling framework, and as new models are developed the potential questions that can be answered will increase. This framework can be thought of as a phylogenetic comparative method because it can be used to test evolutionary hypotheses about the nature of trait change or diversification. However, process-based models, and particularly their implementation, are a relatively recent development. Prior to this unified framework, there was a clearer distinction between phylogenetic inference (inferring relationships) and PCMs (testing hypotheses while treating the tree as known).</p>
<p>There are many reasons (perhaps particularly for paleobiologists) that it might not be feasible, or of interest, to infer phylogenetic relationships as a means to answer other macroevolutionary questions (i.e. to use a process-based approach). Perhaps you have previously estimated a phylogeny but now want to use it to answer new questions, perhaps you are interested in combining several smaller phylogenies to generate a supertree, or perhaps your specific question is not yet answerable in a Bayesian process-based framework. The good news is that when we have a phylogeny that includes extinct taxa as tips, and it is appropriately scaled to time using the stratigraphic record as an extra source of information, trees constructed in many different ways can be used in PCMs to make reliable inferences about evolution (<span class="citation">Soul and Friedman (2015)</span>). This is far less so the case for trees that only include living species (<span class="citation">Slater, Harmon, and Alfaro (2012)</span>, <span class="citation">Louca and Pennell (2019)</span>) - thumbs up for paleontology!</p>
<p><strong>This tutorial.</strong> What follows is an overview of some of the approaches that can be used when you already have a tree in hand. These approaches are what people commonly think of as phylogenetic comparative methods, and some of you may already be familiar with them. Many of these PCMs are used to model trait change through time, and the relationship between that trait change and other variables. But, unlike what we have been doing today so far, most do not model the underlying process that generates the trait change, just it’s outcome. Therefore, as we will see later, different underlying processes can be best fit by the same model. There is also a large suite of approaches (phylogenetic and non) that can be used to estimate diversification rates, those are more likely to be familiar to paleontologists, so for today we will stick to morphology.</p>
<p>New PCMs have been rapidly proliferating in the past 5-10 years, and the kinds of questions they can be used to rigorously answer is now very diverse. Have a look at <a href="https://coggle.it/diagram/WhbkkxE2BAAB0R0m/t/summary-of-phylogenetic-comparative-methods-diogo-b-provete">this infographic</a> by Diogo B. Provete to see what we have available to play with! In this tutorial we will start with some fundamental approaches that are conceptually important, and move on to more complex models if there is time, or if you are already familiar with the fundamentals. Multiple books have been written on this vast topic, but hopefully this is enough to get started or understand some of the idiosyncracies of relevant R functions!</p>
<p><img src="Summary_of_PCMs.png"></p>
<p><em>A tree of approaches that can be applied to trees</em></p>
<p><strong>A note on ‘the dark side’ of phylogenetic comparative methods.</strong> There are several papers (even a whole issue of the journal Methods in Ecology and Evolution!) that highlight situations where phylogenetic comparative approaches do not seem to do the job that we would like them too. It is very important to make sure that the method you use is appropriate for your question and data, and that you apply it correctly, but don’t let these debates deter you from trying out PCMs. When applied correctly they can be very powerful tools for macroevolutionary inference, and it is often the case that considering phylogeny at all will give you more information than ignoring it. Many of the criticisms boil down to needing to fully understand the method you are implementing, not going too far with conclusions, and doing things like checking that parameter estimates are reasonable. If in doubt, simulation can be a powerful tool to try and characterise the behaviour of a particular method when applied to data similar to your own. In this tutorial we have tried to introduce some ways to establish the robustness of results derived from PCMs.</p>
<p>For the worked example we will be switching to a different dataset, for which we already have a set of trees. They’re still echinoderms though! To find out more about the crinoid group Eucladida look at <a href="https://www.nature.com/articles/s41598-017-13979-9">Wright’s paper</a> about variation in rates of character change (<span class="citation">Wright (2017)</span>). We will use a variety of PCMs to characterise the evolutionary history of some traits that are relevant to their feeding ecology.</p>
</div>
<div id="getting-started---data-and-phylogeny" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started---data-and-phylogeny" class="anchor"></a>Getting Started - data and phylogeny</h1>
<p>Set the working directory to the one that contains the data files for this tutorial using <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code> or the session menu.</p>
<p>Start by loading the packages that we will be using in this session. OUwie has the other packages as dependencies but all packages that we will be using are included here for clarity.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/">ape</a></span><span class="op">)</span> <span class="co">#standard format and processing for phylogenies in R</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span> <span class="co">#fitting gaussian models e.g. least squares regression</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mwpennell/geiger-v2">geiger</a></span><span class="op">)</span> <span class="co">#versatile package that performs and plots many pcms</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span> <span class="co">#additional plotting and simulation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OUwie</span><span class="op">)</span> <span class="co">#fitting Hansen models (discussed later)</span></code></pre></div>
<p>You can either read in the tree and data objects pre-prepared using <code><a href="https://rdrr.io/pkg/geiger/man/geiger-internal.html">load("Eucladida_inputs.RData")</a></code> Or follow these instructions to format them ready for analysis. Begin by reading in the maximum a posteriori tree. This is to be used <strong>ONLY</strong> as an example, actual analyses should be performed over a set of trees to assess how robust a result is to topology and branch length variation; more on that later.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span><span class="st">"../../data/Eucladida_MAP.tre"</span><span class="op">)</span></code></pre></div>
<p>The output from RevBayes has branch lengths, but if all tips are extinct you should set the root age by adding the final extinction time to the maximum root to tip distance. This is required by some analyses and makes plotting on a timescale easier.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">root.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html">vcv</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span> <span class="fl">268.8</span><span class="op">)</span></code></pre></div>
<p>The code above makes use of the function vcv; when applied to a tree this gives the phylogenetic variance covariance matrix of that tree. The vcv matrix is very important for many PCMs and it is also an intuitive representation of the tree. Elements on the diagonal of the matrix give the variance, when a tree has branch lengths scaled to time (as paleontological trees usually do) then these values give the root to tip distance for each tip on the tree. This can be very useful, for example <code><a href="https://rdrr.io/r/base/Extremes.html">max(vcv(tree))</a></code> gives the maximum root to tip distance, i.e. the age of the whole tree. The off diagonal elements give the covariance which is the amount of expected shared variance between pairs of taxa. Take a look at the following small example tree and check you can see how it corresponds to the associated vcv matrix.</p>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="50%"></p>
<pre><code>##       t2     t5     t3     t4     t6     t1
## t2 0.206 0.0000 0.0000 0.0000 0.0000 0.0000
## t5 0.000 2.0175 1.2477 1.2477 0.8636 0.1766
## t3 0.000 1.2477 2.4630 1.7454 0.8636 0.1766
## t4 0.000 1.2477 1.7454 2.7373 0.8636 0.1766
## t6 0.000 0.8636 0.8636 0.8636 1.2436 0.1766
## t1 0.000 0.1766 0.1766 0.1766 0.1766 0.9540</code></pre>
<p>The basic plotting function for phylogeny in R from the package <code>ape</code> doesn’t always do a great job. <a href="https://4va.github.io/biodatasci/r-ggtree.html">Here is a tutorial on using ggtree</a> to make nicer tree plots, if you are interested. However, for now just to take a quick look at our tree use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ladderize.html">ladderize</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html">axisPhylo</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>You can see that some taxa were inferred to be ancestral to others that are included in the tree. Unlike in IcyTree, R displays these ancestors as sister to their descendants with 0 length branches. For the methods we are about to use, zero length branches are mathematically intractable, so we will therefore add a very short length to them. If you are concerned about bias this could introduce you could also drop these tips from the tree and compare results, note that in this dataset there are several inferred ancestors so this may represent loss of quite a lot of information. Node labels are required later for <code>OUwie</code> so we will add them now too. ,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">edge.length</span><span class="op">[</span><span class="va">tree</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.001</span>
<span class="va">tree</span><span class="op">$</span><span class="va">node.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Nnode</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For the purposes of this tutorial our main focus is on modelling change in continuous characters, but there is one discrete character for use later on. The three traits we will be modelling are calyx shape (measured as the length/width ratio of the calyx), fan density (approximate number of proximal feeding appendages an individual of the species has), and calyx complexity (number of plates interrupting the posterior interray), which is a discrete trait that could be ordered or unordered, depending on who you ask.</p>
<p>Read in the data, take the natural log of the shape ratio and assign each trait to an individual vector (this format is required by some functions in <code>geiger</code>). Make a table of all taxa for which all three traits are available. Fan density is available for fewer taxa than are included in the tree, so make a pruned tree that only includes the overlapping taxa.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read in data</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"../../data/Shape_and_CalyxComplexity.txt"</span>, 
                   header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">Fan_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"../../data/Fan_density.txt"</span>, 
                       header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#log and assign to separate vectors</span>
<span class="va">Shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Shape</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Shape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="va">Complexity</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Calyx_Complexity</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Complexity</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="va">Density</span> <span class="op">&lt;-</span> <span class="va">Fan_data</span><span class="op">$</span><span class="va">Fan_density</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Density</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Fan_data</span><span class="op">)</span> <span class="co">#this is already a logged value</span>

<span class="co">#drop tips to make smaller tree that matches fan density data</span>
<span class="va">prunedTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/drop.tip.html">drop.tip</a></span><span class="op">(</span><span class="va">tree</span>, 
                       <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Density</span><span class="op">)</span><span class="op">)</span>
                       <span class="op">)</span>

<span class="co">#make table with no missing data</span>
<span class="va">overlapTaxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, 
                         <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Fan_data</span><span class="op">)</span><span class="op">)</span>
<span class="va">allTraits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  Species <span class="op">=</span> <span class="va">overlapTaxa</span>, 
  Shape <span class="op">=</span> <span class="va">Shape</span><span class="op">[</span><span class="va">overlapTaxa</span><span class="op">]</span>, 
  Complexity <span class="op">=</span> <span class="va">Complexity</span><span class="op">[</span><span class="va">overlapTaxa</span><span class="op">]</span>, 
  Density <span class="op">=</span> <span class="va">Density</span><span class="op">[</span><span class="va">overlapTaxa</span><span class="op">]</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="phylogenetic-non-independence" class="section level1">
<h1 class="hasAnchor">
<a href="#phylogenetic-non-independence" class="anchor"></a>Phylogenetic non-independence</h1>
<p>Felsenstein outlined the problem of the non-independence of species trait data, and an algorithm to account for the problem - phylogenetic independent contrasts (PIC) - in 1985 (<span class="citation">Felsenstein (1985)</span>). The most common evolutionary question that this problem and solution are relevant to is that of the relationship between two traits. The original formulation and explanatory figure have led to this approach being commonly referred to as ‘correcting’ for phylogeny, which has in turn led to some misunderstandings. Although it is true that without considering phylogeny a comparative analysis of two species variables might be statistically invalid, it might be helpful to think of PIC (and its more general relative phylogenetic generalised least squares (PGLS)) as incorporating the additional useful infomation that phylogeny provides, into the estimation of the relationships between traits.</p>
<p><img src="contrasts.png"></p>
<p><em>The problem of species non-independence and how standardised phylogenetic independent contrasts resolves this. The red line would be the slope of the ols regression. Adapted from <span class="citation">Nunn and Barton (2001)</span> </em></p>
<p>The problem: The extreme case of the problem of non-independence of species data is shown in the original <span class="citation">Felsenstein (1985)</span> paper, as well as the example figure above. Basically, there could be a relatively shallow relationship between two traits, but an early split in a clade has lead to species in one part of the tree having overall higher values in both traits than species in the other part of the tree. The early split means that species in the two parts of the tree have been evolving separatetely from one another for a long time, and so have had a long time to accumulate differences between them, species in the same clade are more similar because of their shared evolutionary history. This leads to a regression line that is too steep when all the species data are considered together. Regression analysis assumes that individual data points are statistically independent from one another, this assumption is violated by species data because of shared evolutionary history. PIC is an intuitive approach, it takes the average trait value of sister clades and weights this by the amount of time they have been evolving separately. Most researchers now use phylogenetic generalised least squares (PIC is a special case of PGLS, they are mathematically equivalent when you assume a Brownian motion model of trait change; see the tempo and mode section for an explanation of Brownian motion). After an ordinary least squares (OLS) regression is done on species data, there will be phylogenetic signal that dictates how far each datapoint is from the regression line (its residual), we say therefore that there is phylogenetic structure in the residuals of the regression. PGLS adjusts the regression line so that the residuals are normally distibuted, rather than structured.</p>
<p>For our worked example we will start by using PGLS. Say we are interested in whether calyx shape correlates with fan density, we could use the pearson correlation co-efficient, or perform an OLS regression:</p>
<p>First of all plot the data!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">allTraits</span><span class="op">$</span><span class="va">Shape</span>, <span class="va">allTraits</span><span class="op">$</span><span class="va">Density</span>, 
     pch <span class="op">=</span> <span class="fl">19</span>, main <span class="op">=</span> <span class="st">""</span>, 
     xlab <span class="op">=</span> <span class="st">"Calyx shape ln(L/W)"</span>, 
     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ln[Fan density]"</span>,<span class="st">" "</span>, <span class="st">"("</span>,<span class="va">Omega</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span>
     <span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The standard test of correlation between two continuous variables is the Pearson correlation coefficient. Does this test indicate shape and fan density are correlated?</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">allTraits</span><span class="op">$</span><span class="va">Shape</span>, <span class="va">allTraits</span><span class="op">$</span><span class="va">Density</span><span class="op">)</span> </code></pre></div>
<p>Now run an OLS, what is the slope and intercept of the relationship?</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html">gls</a></span><span class="op">(</span><span class="va">Density</span> <span class="op">~</span> <span class="va">Shape</span>, 
           data <span class="op">=</span> <span class="va">allTraits</span>, method <span class="op">=</span> <span class="st">"ML"</span><span class="op">)</span></code></pre></div>
<p>Now we will fit a phylogenetic least squares regression line, using the same <code>gls</code> function as before, but this time including the vcv matrix as the expected structure in the residuals. Generalised least squares regression is a very flexible framework that allows you to supply correlation structure for the residuals of the regression that can be derived from any potential source of non-independence. For example, here we are using phylogeny, but as some traits are known to vary systematically across space, a matrix of expected spatial covariance could also be used.</p>
<p>Note that this model uses two extra arguments. First <code>correlation</code> which defines the expected structure in the residuals, in this case based on the phylogeny and a brownian motion model. Trees that have extinct taxa in them and are scaled to time are referred to as ‘non-ultrametic’, in contrast to ‘ultrametric’ trees where all the tips end simultaneously at the present day as is the case with trees of living taxa. The argument <code>weights</code> is a modification to account for the different root to tip distances in our non-ultrametric tree - important for paleontologists.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tip.heights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html">vcv</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">prunedTree</span><span class="op">)</span><span class="op">)</span>
<span class="va">cor.BM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/corBrownian.html">corBrownian</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">prunedTree</span><span class="op">)</span>
<span class="va">pgls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html">gls</a></span><span class="op">(</span><span class="va">Density</span> <span class="op">~</span> <span class="va">Shape</span>, 
            correlation <span class="op">=</span> <span class="va">cor.BM</span>, 
            weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/varFixed.html">varFixed</a></span><span class="op">(</span><span class="op">~</span><span class="va">tip.heights</span><span class="op">)</span>, 
            data <span class="op">=</span> <span class="va">allTraits</span>, 
            method <span class="op">=</span> <span class="st">"ML"</span>
            <span class="op">)</span></code></pre></div>
<pre><code>## Warning in Initialize.corPhyl(X[[i]], ...): No covariate specified, species
## will be taken as ordered in the data frame. To avoid this message, specify a
## covariate containing the species names with the 'form' argument.</code></pre>
<p>Now that we have fit both OLS and PGLS we can compare them using the Akaike Information Critereon (AIC) to see which is a better model for the data. When there is low or no phylogenetic signal in the residuals of the regression then ols will be the better model as it has fewer parameters. We can check the AIC scores with the output of the <code>gls</code> function that we stored in the objects ols and pgls. Which is a better model for our crinoid data? Are the two traits significantly correlated?</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ols</span><span class="op">)</span><span class="op">$</span><span class="va">AIC</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pgls</span><span class="op">)</span><span class="op">$</span><span class="va">AIC</span></code></pre></div>
<p>We can plot the data again and look at the two different regression lines. If PGLS is a better model we would expect any new specimens discovered to fall somewhere closer to the PGLS regression than the ols.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">allTraits</span><span class="op">$</span><span class="va">Shape</span>, <span class="va">allTraits</span><span class="op">$</span><span class="va">Density</span>, 
     pch <span class="op">=</span> <span class="fl">19</span>, main <span class="op">=</span> <span class="st">""</span>, 
     xlab <span class="op">=</span> <span class="st">"Calyx shape ln(L/W)"</span>, 
     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ln[Fan density]"</span>,<span class="st">" "</span>, <span class="st">"("</span>,<span class="va">Omega</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span>
     <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">ols</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">pgls</span><span class="op">$</span><span class="va">coefficients</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>There is repeated discussion on whether or not researchers should or should not ‘correct for phylogeny’ in a particular analysis. In the context of analyses like regression or ANOVA to understand trait correlations and adaptation, the key thing to bear in mind is that if there is phylogenetic signal in the <strong>residuals</strong> then the resulting relationship derived is statistically invalid because the assumption of independent data has been violated. Phylogenetic signal in any of the individual traits under investigation does not necessarily mean the residuals will have phylogenetic structure, or vice versa. Liam Revell’s 2010 paper provides a thorough explanation of this issue <span class="citation">Revell (2010)</span>. If in doubt, rather than using ‘corBrownian’ you can use ‘corPagel’ to define the correlation structure, this will jointly esitmate lambda which is a measure of the phylogenetic signal in the residuals. As lambda gets closer to 0 the estimated coefficients in pgls will converge on those estimated using ols. Also bear in mind that all models are wrong, but some are more wrong than others, and in this case to do a non-phylogenetic analysis is equivalent to assuming the phylogeny is a star.</p>
</div>
<div id="tempo-and-mode---brownian-motion-and-more" class="section level1">
<h1 class="hasAnchor">
<a href="#tempo-and-mode---brownian-motion-and-more" class="anchor"></a>Tempo and mode - Brownian motion and more</h1>
<p>Explicitly modelling morphological change provides a framework with which we can quantitatively test hypotheses about macroevolution. Through models we can link evoluionary histories of groups to different biotic or abiotic factors and link patterns in morphological evolution to concepts like convergence, contstraint, evolutionary radiations and the adaptive landscape. In this section we will explore the models that form the foundation of many phylogenetic comparative methods.</p>
<p>First of all, lets take a look at our tree plotted as a traitgram in ‘phylomorphospace’ this basically just means that the y axis is meaningful (the trait value) rather than when we usually show trees where the branching order but not the position of the tips matters. The <code>phenogram</code> function requires that the tree and trait have matching taxa and the trait vector has names corresponding to the tree tip labels (i.e. taxon names).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ftype controls how the taxon names are displayed</span>
<span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phenogram.html">phenogram</a></span><span class="op">(</span><span class="va">prunedTree</span>, <span class="va">Density</span>, ftype <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> </code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phenogram.html">phenogram</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">Shape</span>, ftype <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> </code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-15-2.png" width="700"></p>
<p>This function is from the package <code>phytools</code>. Positions of the tips on the y axis are just the trait values, the positions of the nodes are estimated assuming Brownian motion, they should not be considered rigorous estimates of ancestral trait values, at this stage they are just for visualisation.</p>
<div id="brownian-motion" class="section level2">
<h2 class="hasAnchor">
<a href="#brownian-motion" class="anchor"></a>Brownian motion</h2>
<p>Brownian motion (sometimes known as a ‘random walk’ model of evolution) is a model that can be used to describe the expected variance of a trait along branches of a phylogeny through time. It is called a random walk because the direction and amount of change in each time step is independent of the direction and amount of change in the previous time step. The amount of change expected in each time step (the step rate, referred to by the model parameter <span class="math inline">\(\sigma^{2}\)</span> is constant over time, so the trait variance across the tips of the phylogeny increases over time. The model assumes no directionality of trait change, so there is a phylogenetic trait mean (referred to by the model parameter <span class="math inline">\(\theta\)</span> that is also the trait value for the ancestral node of the phylogeny. Trait values of lineages wander around this phylogenetic mean through time. The longer a branch on the tree is, the greater potential there is for change in the trait value, and the less time it is since two branches split from a common ancestral branch the more similar they are expected to be because there has been less time for them to accumulate change and therefore difference between them. The name ‘random walk’ is perhaps a little misleading, on macroevolutionary timescales it is not random in the sense that genetic drift might be considered random, the change over time is most likely as a result of the combination of selection acting on the trait as well as genetic drift, and the direction of selection might fluctuate over time as a result of different causes. It is therefore best thought of as a stochastic model for patterns of character change. For other explanations of Brownian motion on phylogenies see <span class="citation">Nunn (2011)</span> or <span class="citation">Harmon (2019)</span>.</p>
<p>We will begin by fitting Brownian motion models to both of our continuous traits using a function from the <code>geiger</code> package.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">densityBM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">prunedTree</span>, 
                           dat <span class="op">=</span> <span class="va">Density</span>, model <span class="op">=</span> <span class="st">"BM"</span><span class="op">)</span>

<span class="va">shapeBM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, 
                         dat <span class="op">=</span> <span class="va">Shape</span>, model <span class="op">=</span> <span class="st">"BM"</span><span class="op">)</span></code></pre></div>
<p>Take a look at the outputs <code>densityBM</code> and <code>shapeBM</code>. What is the estimated rate of evolution? What is the phylogenetic mean trait value (equivalent to the ancestral state at the root of the tree)?</p>
<p>##And more - alternative models of trait change</p>
<p>It is reasonable to think that a simple Brownian motion model of evolution might not be an adequate description of patterns of morphological variation over millions of years. As paleontologists, we can think of many examples when patterns in the fossil record suggest periods of constraint or rapid increases in morphological disparity. Fortunately there is a straightforward framework that extends the Brownian motion model and can be used to model these kinds of patterns. The most commonly implemented alternative model is one that can be used to describe stabilising selection - the Ornstein-Uhlenbeck model (OU, or a Hansen model after <span class="citation">Hansen (1997)</span> who fit it to phylogeny). In this model there is an additional parameter - alpha <span class="math inline">\(\alpha\)</span>. <span class="math inline">\(\theta\)</span> still is a parameter in the model, but now it can more appropriately be thought of as the optimum value for the trait. There is still a random walk included, the actual value of the trait varies along branches, but it is biased towards getting closer to the optimum. The strength of that bias or attraction towards the trait optimum is <span class="math inline">\(\alpha\)</span>. Unlike in pure Brownian motion the variance does not increase linearly with time, traits evolving under OU will therefore be less tightly linked to the structure of the phylogeny, in other words they will have less phylogenetic signal. For a helpful summary of rates of evolution in this model framework, and how they relate to different models, see <span class="citation">Hunt (2012)</span> and <span class="citation">Hunt and Rabosky (2014)</span>. <span class="citation">Nunn (2011)</span> also contains straightforward descriptions of BM and OU.</p>
<p>Aside from OU, other models you may have heard of are ‘Early Burst’ or ‘ACDC’, those are models where the step rate <span class="math inline">\(\sigma^{2}\)</span> changes through time. A Brownian motion with a trend model (a biased random walk) has two parameters, the step rate <span class="math inline">\(\sigma^{2}\)</span> and the mean step change <span class="math inline">\(\mu\)</span> which gives the direction and magnitude of the bias.</p>
<p>Lets take a look at some simulations to get a better sense of what trait evolution on a phylogeny might look like under these different models. Try changing <code>sig2</code> (<span class="math inline">\(\sigma^{2}\)</span>) the evolutionary rate parameter to see what happens.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>

<span class="va">bmsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/bmPlot.html">bmPlot</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">simtree</span>, 
       type<span class="op">=</span><span class="st">"BM"</span>, 
       anc<span class="op">=</span><span class="fl">0</span>, 
       sig2<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">bmsim</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span>,
     xlab <span class="op">=</span> <span class="st">"Trait values"</span>,
     main <span class="op">=</span> <span class="st">"Simulated values at tips"</span>
     <span class="op">)</span><span class="co">#Look at the tip values</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<p>The above plot shows changing trait values in discrete time steps for the whole history of the clade. Normally we would only know the values at the tips, and be dealing with continuous time, so instead we can look at a phenogram. This time we will simulate both BM and OU. see what happens when you change each of the model parameters? Try making the optimum value theta different from the starting trait value at the root.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simtree</span> <span class="op">&lt;-</span> <span class="va">tree</span>
<span class="va">BM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rTraitCont.html">rTraitCont</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">simtree</span>,
                 model <span class="op">=</span> <span class="st">"BM"</span>,
                 sigma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phenogram.html">phenogram</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">simtree</span>,
          x<span class="op">=</span><span class="va">BM</span>,
          ftype <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">OU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rTraitCont.html">rTraitCont</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">simtree</span>,
                 model <span class="op">=</span> <span class="st">"OU"</span>,
                 sigma <span class="op">=</span> <span class="fl">0.1</span>,
                 alpha <span class="op">=</span> <span class="fl">0.1</span>,
                 theta <span class="op">=</span> <span class="fl">0</span>,
                 root.value <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phenogram.html">phenogram</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">simtree</span>,
          x<span class="op">=</span><span class="va">OU</span>,
          ftype <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-18-2.png" width="700"></p>
<p>Now that we’ve used simulations to get a sense of the effect of the specified model and each model parameter on the shape of the trait distribution let’s try fitting some models to our real data.</p>
<p>First fit OU models to each trait:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">densityOU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">prunedTree</span>, dat <span class="op">=</span> <span class="va">Density</span>, model <span class="op">=</span> <span class="st">"OU"</span><span class="op">)</span>
<span class="va">shapeOU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, dat <span class="op">=</span> <span class="va">Shape</span>, model <span class="op">=</span> <span class="st">"OU"</span><span class="op">)</span></code></pre></div>
<p>Then fit an early burst model:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">densityEB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">prunedTree</span>, dat <span class="op">=</span> <span class="va">Density</span>, model <span class="op">=</span> <span class="st">"EB"</span><span class="op">)</span>
<span class="va">shapeEB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, dat <span class="op">=</span> <span class="va">Shape</span>, model <span class="op">=</span> <span class="st">"EB"</span><span class="op">)</span></code></pre></div>
<p>Look at the paramater values for each model fit, are they biologically reasonable? (You should get a warning for one of them, which is a first indicator that the parameter or model might not be a good one for the data) Checking parameter estimates is an important step, particularly because for OU models the different parameter estimates can interact with each other.</p>
<p>We have turned off the warnings here but if you take a look at them you will see that OU gives a warning about using the vcv matrix. In the original version of this function, to fit OU quickly, the algorithm rescaled the branch lengths, this is problematic for non-ultrametic trees so now this and other functions modify the variance-covariance matrix directly to avoid the issue. Almost all PCMs (especially commonly used ones) can be applied to non-ultrametric trees using R implementations, but this is a good reminder that it is important to check.</p>
<p><strong>Something to think about</strong> If there are errors (relative to actual evolutionary relationships) in the tree topology we are using, what kind of model will this bias our analyses towards? What about error in the trait measurements? Silvestro et al. show with simulation that incorporating an estimate error should be a priority, and that not doing so in general biases towards OU as the best fit model even when trait change was simulated as BM (<span class="citation">Silvestro et al. (2015)</span>).</p>
<p>Now that we have checked to see whether the parameter estimates for the various models are reasonable, look at the AICcs, which is the best fit model for each of the traits?</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">densityBM</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">densityOU</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">densityEB</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span>

<span class="va">shapeBM</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">shapeOU</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">shapeEB</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">aicc</span></code></pre></div>
</div>
</div>
<div id="variation-across-trees" class="section level1">
<h1 class="hasAnchor">
<a href="#variation-across-trees" class="anchor"></a>Variation across trees</h1>
<p>In the previous exercises we have been using the maximum a posteriori tree as the phylogenetic framework. However, all the exercises that you did earlier resulted in a posterior distibution of trees. Given that none of us expect that the maximum a posteriori tree perfectly represents evolutionary truth, it is important to get some measure of the robustness of our results to variation in topology and branch lengths. This is true whatever approach is used to infer the tree topology and branch lengths; using a point estimate of the tree is never recommended. The easiest way to understand how important variation across trees is for your result, is to run the analysis over a set of different trees. Here we will randomly select 100 from the posterior distribution. Other commonly used sizes for tree sets are 500 and 1000, really it is arbitrary and at the researchers discretion as to how large a set of trees they need to include in order to fully characterise the variation in results. If you haven’t used a Bayesian inference approach you could select a set of trees from the MPTs, and/or a set of trees from the output of a timescaling algorithm to understand the effect of branch length variation.</p>
<p>Load the post burnin posterior set of trees and select a subsample of them, add a root age and extend zero length branches as before:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span><span class="st">"../../data/Eucladida_postBurnIn.tre"</span><span class="op">)</span>
<span class="va">treeset</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5000</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span>
<span class="va">root.time</span> <span class="op">&lt;-</span> <span class="fl">268.8</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">treeset</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">treeset</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">root.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html">vcv</a></span><span class="op">(</span><span class="va">treeset</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">root.time</span>
<span class="op">}</span></code></pre></div>
<p>Choose one of the previous analyses and run it over the entire treeset. How much variation is there? How much confidence do you now have in the result you obtained previously?</p>
<p>For example you could fit BM to each tree (warning this could take a while):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>length<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">currentTree</span> <span class="op">&lt;-</span> <span class="va">treeset</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="va">fitBM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitContinuous.html">fitContinuous</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">currentTree</span>, 
                         dat <span class="op">=</span> <span class="va">Shape</span>, model <span class="op">=</span> <span class="st">"BM"</span><span class="op">)</span>
    <span class="va">sigmas</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fitBM</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">sigsq</span>
<span class="op">}</span>

<span class="co">#look at the variation in the estimate of the evolutionary step rate parameter across trees</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">sigmas</span><span class="op">)</span></code></pre></div>
<p>Once analyses have been run over the treeset the results should be summarised appropriately. There is not yet a universally agreed upon way to do this, but in general, approaches such as displaying median values with the variation around them (as long as it is made clear that this variation is separate from the error or confidence intervals on the results themselves), showing model support across trees in a bar plot, or showing a representative result and discussing how robust it is, have been used in the literature. Some methods do have built in ways of summarising across sets of trees (see for example <code>rjmcmc</code> in <code>geiger</code>), but this is rare.</p>
</div>
<div id="model-fit-and-model-adequacy" class="section level1">
<h1 class="hasAnchor">
<a href="#model-fit-and-model-adequacy" class="anchor"></a>Model fit and model adequacy</h1>
<p>Much of what we have just done involved fitting models of evolution to data, by estimating the maximum likelihood parameter values for a particular model, given the data. We then compared the AIC scores of each model fit to see which was the best fit model, and what that might tell us about evolution of the clade in question. However, just because one model is a better fit than the other models that were tested, it does not necessarily mean that it is a good model. To quote Matthew Pennell “All models are wrong and sometimes even the best of a set of models is useless”. With simple models like regression, taking steps like plotting the data or looking at the residuals can help establish how good the model is, but with more complex approaches (i.e. most phylogenetic comparative methods) visualisation is unlikely to help. There are not well established model adequacy testing approaches (although see <a href="https://www.journals.uchicago.edu/doi/10.1086/682022">Arbutus</a> for trees where all tips are extant). One possible solution is to use simulation for ‘posterior prediction’ (this is what Arbutus does for phylogenies of extant taxa). This approach can be applied to paleontological trees as well, although the mechanics are slightly different.</p>
<ol style="list-style-type: decimal">
<li>Find the best fit model</li>
<li>Identify the model parameters</li>
<li>Use these parameters to repeatedly simulate trait change under the best fit model on the original phylogeny</li>
<li>Calculate the standardised independent contrasts of the original data and all the simulated data</li>
<li>Compare test statistics of the contrasts from the real data and distribution of simulated data.</li>
<li>If real data test statitics fall within the distributions of simulated test statistics the model is adequate</li>
</ol>
<p>For example, was the OU model that earlier we found was the best out of the single regime models we fit to our shape data, actually a good model? We test this below by comparing the mean of the squared contrasts, and the coefficient of variation of the absolute contrasts as examples. For other test statistics see <a href="https://github.com/mwpennell/arbutus/blob/master/R/summary-stats.R">Arbutus code</a>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#assign the estimated parameters from the best fit model</span>
<span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">shapeOU</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">alpha</span>
<span class="va">sigma.sq</span> <span class="op">&lt;-</span> <span class="va">shapeOU</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">sigsq</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">shapeOU</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">z0</span>

<span class="va">shapeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Shape</span><span class="op">)</span>, 
                        regime <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="va">Shape</span><span class="op">)</span>

<span class="co">#simulate on the tree under the best fit model</span>
<span class="va">simtrait</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">100</span>, 
                      <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.sim.html">OUwie.sim</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, 
                                data <span class="op">=</span> <span class="va">shapeData</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="co">#This just gives the tips and regime, no data</span>
                                root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span>, 
                                alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha</span>,<span class="va">alpha</span><span class="op">)</span>, 
                                sigma.sq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sigma.sq</span>,<span class="va">sigma.sq</span><span class="op">)</span>, 
                                theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">theta</span>,<span class="va">theta</span><span class="op">)</span>, 
                                theta0 <span class="op">=</span> <span class="va">theta</span>
                                <span class="op">)</span>
                      <span class="op">$</span><span class="va">X</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">simtrait</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">shapeData</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">realContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/pic.html">pic</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, x <span class="op">=</span> <span class="va">Shape</span><span class="op">)</span> <span class="co">#phylogenetic independent contrasts of real data</span>
<span class="va">simContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">simtrait</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">pic</span>,phy <span class="op">=</span> <span class="va">tree</span><span class="op">)</span> <span class="co">#phylogenetic independent contrasts of simulated data</span>

<span class="co">#Two example test statistics</span>
<span class="va">sqsimContrasts</span> <span class="op">&lt;-</span> <span class="va">simContrasts</span><span class="op">^</span><span class="fl">2</span>
<span class="va">abssimContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">simContrasts</span><span class="op">)</span>
<span class="va">CofVar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">simMSContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">sqsimContrasts</span>, MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span>
<span class="va">simCofVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">abssimContrasts</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">CofVar</span><span class="op">)</span>

<span class="co">#Plot to see where real test statistic falls in distribution of simulated test statistic</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">simCofVar</span>, main<span class="op">=</span><span class="st">"Mean squared PIC"</span>, xlab <span class="op">=</span> <span class="st">"Mean squared PIC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu">CofVar</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">realContrasts</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" width="50%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">simMSContrasts</span>, main <span class="op">=</span> <span class="st">"Coefficient of Variation"</span>, xlab <span class="op">=</span> <span class="st">"coefficient of Variation"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">realContrasts</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-24-2.png" width="50%"></p>
</div>
<div id="choose-your-own-adventure" class="section level1">
<h1 class="hasAnchor">
<a href="#choose-your-own-adventure" class="anchor"></a>Choose Your Own Adventure</h1>
<p>As we mentioned right at the beginning of the tutorial there are now <strong>a lot</strong> of different phylogenetic comparative approaches that can be applied to treesets to answer a diversity of questions.</p>
<p>If you have gotten this far, please check that your table companions are not in need of assisstance. Then investigate one of the following approaches; there is only a full working example for modelling discrete traits using <code>geiger</code> and for multi-regime models in <code>OUwie</code>, but the instructors have example code for several of the other approaches if you are interested.</p>
<div id="post-hoc-modelling-of-discrete-characters" class="section level2">
<h2 class="hasAnchor">
<a href="#post-hoc-modelling-of-discrete-characters" class="anchor"></a>Post-hoc Modelling of Discrete Characters</h2>
<p>If a discrete trait is inluded in the phyloegnetic inference analysis then rates and ancestral states can be jointly estimated as with other parameters. However, if you have a tree already and want to characterise a discrete trait that was not included in the inference analysis then you can use <code>geiger</code> similarly to how we used it to fit continuous traits earlier.</p>
<p>First fit a model with a single parameter for all transition rates</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ER</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitDiscrete.html">fitDiscrete</a></span><span class="op">(</span><span class="va">tree</span>, dat <span class="op">=</span> <span class="va">Complexity</span>, model <span class="op">=</span> <span class="st">"ER"</span><span class="op">)</span></code></pre></div>
<p>Then a model where each rate is a unique parameter:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ARD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitDiscrete.html">fitDiscrete</a></span><span class="op">(</span><span class="va">tree</span>, dat <span class="op">=</span> <span class="va">Complexity</span>, model <span class="op">=</span> <span class="st">"ARD"</span><span class="op">)</span></code></pre></div>
<p>Given that this is a multistate character, you might think (as some echinoderm workers do) that the character is ordered so that transitions can only occur between consecutive states. In this case you can use the <code>meristic</code> model</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MER</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geiger/man/fitDiscrete.html">fitDiscrete</a></span><span class="op">(</span><span class="va">tree</span>, dat <span class="op">=</span> <span class="va">Complexity</span>, model <span class="op">=</span> <span class="st">"meristic"</span><span class="op">)</span></code></pre></div>
<p>As with previous model fits we can check the AICcs to see which model fits our data better.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ER</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">ARD</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aicc</span>
<span class="va">MER</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">aicc</span></code></pre></div>
<p>It is also straightforward to reconstruct ancestral states, this assumes an equal rates model. Phytools has useful functions for plotting the likelihood of a given state onto the tree.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anc.char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/ace.html">ace</a></span><span class="op">(</span><span class="va">Complexity</span>, <span class="va">tree</span>, type <span class="op">=</span> <span class="st">"discrete"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ladderize.html">ladderize</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">nodelabels</a></span><span class="op">(</span>pie <span class="op">=</span> <span class="va">anc.char</span><span class="op">$</span><span class="va">lik.anc</span>, 
           piecol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>,<span class="st">"darkblue"</span>, <span class="st">"salmon"</span>, <span class="st">"darkred"</span><span class="op">)</span>, 
           cex <span class="op">=</span> <span class="fl">0.5</span>
           <span class="op">)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p><em>Pie charts plotted on each node showing the likelihood the trait is in each state at that node</em></p>
</div>
<div id="multi-regime-ou-models" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-regime-ou-models" class="anchor"></a>Multi-regime OU models</h2>
<p>As we saw above, Ornstein-Uhlenbeck models have three or four parameters that define an ‘adaptive peak’. This can also be thought of as a macroevolutionary regime; for some period of time the evolution of a set of taxa can be characterised using single estimates for those parameters, and though the actual mechanisms generating the observed patterns may vary through time, they have the same outcome. This model is consistent with Simpson’s concept of the adaptive landscape. Often we would not expect that a clade would remain in the same macroevolutionary regime (i.e. where the same trait value is optimal and the strength of <span class="math inline">\(\alpha\)</span> (the constraint parameter) remains the same) over the many tens of millions of years of its evolutionary history, or that all branches of a clade would experience the same regime. We might also be interested in how the regime a clade experiences might relate to factors like environmental change.</p>
<p>Fortunately it is possible to model shifts in the evolutionary regime through time, by estimating new parameter values for different sections of the phylogeny. The package <code>OUwie</code> has model fitting and trait simulaiton functions for this. It requires a priori definition of clade or time regime shift points, it is therefore suitable for hypothesis testsing. See also packages <code>mvMorph</code>, <code>mvSLOUCH</code>, <code>OUCH</code> and <code>ape</code>.</p>
<p><code>OUwie</code> can be used to fit models where one or more of the rate of evolution, strength of alpha or trait optimum value can change at shift points.</p>
<p>Multi-regime OU models can be very complex, and are therefore often difficult for the function to fit. It is <strong>especially</strong> important that you check the parameter values when you use this function, to make sure that they are sensible. For example if you get values for <span class="math inline">\(\theta\)</span> or <span class="math inline">\(\theta\)</span>_0 that are outside the known range of trait values, or get unreasonably high values for the step rate <span class="math inline">\(\sigma^{2}\)</span>. Looking to the literature for rates that might be reasonable for your trait could also help.</p>
<p>The following example uses the same crinoid data that we have been using previously, with possible regime shift points based on Davey’s prior knowledge as a crinoid systematist &amp; taxonomist familiar with their morphology and ontogeny, derived from previous experience and knowledge of the published literature. When choosing possible shift points for your own trees, it will be helpful to relate them to specific hypotheses about factors that may have effected their evolutionary history (e.g. novel adaptation, dispersal to a new region, environmental change like sea level fall).</p>
<p>OUwie has a very specific format required for the input data. It requires a three column data frame where the first column is the taxon names, the second is the regime each tip is in (this can be overwritten later by defining a clade that has its own regime using the ‘clade =’ argument, see script below) and the third column is the trait data. You can optionally give a fourth column with the standard error of the trait measurements (this means an estimate of the intraspecific error if you have multiple specimens, plus measurement error), this is adviseable whenever it is possible. The tree must have internal node labels corresponding to the regime, again this can either be set in advance, or overwritten using the ‘clade =’ argument within the function. If set in advance you must set two or more regimes even if you are going to fit a single regime model where these will be overwritten, or you will get an error.</p>
<p>First set up data frame and tree correctly:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shapeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Shape</span><span class="op">)</span>, 
                        regime <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="va">Shape</span><span class="op">)</span>
<span class="va">densityData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Density</span><span class="op">)</span>, 
                          regime <span class="op">=</span> <span class="fl">1</span>, density <span class="op">=</span> <span class="va">Density</span><span class="op">)</span> 
<span class="co">#gets overwritten with correct labels later</span>
<span class="va">tree</span><span class="op">$</span><span class="va">node.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, 
                          <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Nnode</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 
<span class="va">prunedTree</span><span class="op">$</span><span class="va">node.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, 
                                <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Nnode</a></span><span class="op">(</span><span class="va">prunedTree</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><code>OUwie</code> has several options for models, you can allow the strength of the selection parameter <span class="math inline">\(\alpha\)</span> to shift, the trait optimum <span class="math inline">\(\theta\)</span>, or the evolutionary rate <span class="math inline">\(\sigma\)</span>, you can also fix or vary different combinations of these for each regime.</p>
<p>We will start by using the function to estimate brownian motion and OU parameters applied to the whole of the tree, for both shape and density, as we did previously using the <code>fitContinuous</code> function in <code>geiger</code>. As an argument in the function you must also provide the time of the root of the tree with <code>root.age=</code>, because this tree does not end at the present day. You can optionally provide starting values, often there is no problem but sometimes without them the function can have difficulty estimating parameters for the models (especially if the models do not fit the data well). This was the case here for the OU models. Ideally you would start the algorithm from a variety of values to make sure that it converges on the same parameter estimates, and not local optima. The argument <code>root.station</code> says whether the algorithm should estimate theta_0 the starting state (trait value) should be estimated as part of the model. Sometimes estimates of theta_0 and <span class="math inline">\(\alpha\)</span> can interact, setting <code>root.station = TRUE</code> means that the starting state is not estimated, this can stabilise estimates of the adaptive optimum theta. If you have reason to think there may be a trend (different starting and optimum trait means) then include theta_0 but be sure to check that the final parameter estimates are sensible. It can be sensible to check the results with both and compare.</p>
<p>Does <code>OUwie</code> give the same parameter estimates that the other function in <code>geiger</code> did for single regime models? What difference does specifying the error make?</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shapeBM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, data <span class="op">=</span> <span class="va">shapeData</span>, 
                 model <span class="op">=</span> <span class="st">"BM1"</span>, root.station <span class="op">=</span> <span class="cn">FALSE</span>, 
                 quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                 root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">shapeOU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tree</span>, data <span class="op">=</span> <span class="va">shapeData</span>, 
                 starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                 quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                 model <span class="op">=</span> <span class="st">"OU1"</span>, root.station <span class="op">=</span> <span class="cn">FALSE</span>, 
                 root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">densityBM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">prunedTree</span>, data <span class="op">=</span> <span class="va">densityData</span>, 
                   model <span class="op">=</span> <span class="st">"BM1"</span>, root.station <span class="op">=</span> <span class="cn">FALSE</span>, 
                   quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                   root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">densityOU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">prunedTree</span>, data <span class="op">=</span> <span class="va">densityData</span>, 
                   starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                   quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                   model <span class="op">=</span> <span class="st">"OU1"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                   root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span></code></pre></div>
<p>Now lets look at a multi-peak model. There are two subclades within the tree that seem to show many modifications associated with building a dense filtration fan (e.g. many branches per arm or many pinnules on branches). We can test whether this high density of the fan was associated with a different trait mean or rate of evolution. In this example we will define the tip and node regimes ourselves beforehand because it involves more than one clade. If we hypothesise a rate shift in only one clade it is easiest to use the <code>clade=</code> argument withinthe <code>OUwie</code> function.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#find node defining first clade</span>
<span class="va">mrca1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/mrca.html">getMRCA</a></span><span class="op">(</span><span class="va">prunedTree</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blothrocrinus"</span>, <span class="st">"Hydreionocrinus"</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#make a vector of all descending nodes and tips</span>
<span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mrca1</span>, <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/getDescendants.html">getDescendants</a></span><span class="op">(</span><span class="va">prunedTree</span>, <span class="va">mrca1</span><span class="op">)</span><span class="op">)</span> 
<span class="va">mrca2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/mrca.html">getMRCA</a></span><span class="op">(</span><span class="va">prunedTree</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pirasocrinus"</span>, <span class="st">"Zeacrinites"</span><span class="op">)</span><span class="op">)</span>
<span class="va">second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mrca2</span>, <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/getDescendants.html">getDescendants</a></span><span class="op">(</span><span class="va">prunedTree</span>, <span class="va">mrca2</span><span class="op">)</span><span class="op">)</span>

<span class="co">#combine clade vectors</span>
<span class="va">desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">second</span><span class="op">)</span> 

<span class="co">#separate into tip and node vectors</span>
<span class="va">tips</span> <span class="op">&lt;-</span> <span class="va">prunedTree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">[</span><span class="va">desc</span><span class="op">[</span><span class="va">desc</span><span class="op">&lt;=</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Ntip</a></span><span class="op">(</span><span class="va">prunedTree</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> 
<span class="va">nodes</span> <span class="op">&lt;-</span> <span class="va">desc</span><span class="op">[</span><span class="va">desc</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Ntip</a></span><span class="op">(</span><span class="va">prunedTree</span><span class="op">)</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Ntip</a></span><span class="op">(</span><span class="va">prunedTree</span><span class="op">)</span>
<span class="va">treeD</span> <span class="op">&lt;-</span> <span class="va">prunedTree</span>
<span class="va">treeD</span><span class="op">$</span><span class="va">node.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html">Nnode</a></span><span class="op">(</span><span class="va">treeD</span><span class="op">)</span><span class="op">)</span>
<span class="va">treeD</span><span class="op">$</span><span class="va">node.label</span><span class="op">[</span><span class="va">nodes</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span><span class="op">)</span>

<span class="va">regimetableD</span> <span class="op">&lt;-</span> <span class="va">densityData</span>
<span class="va">regimetableD</span><span class="op">[</span><span class="va">tips</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<p>We have prepared the tree and table so that they have the regimes defined appropriately for our question, now we can fit a variety of models. Here we have dropped theta_0 from the model, if you want to you can add it back in using <code>root.station=FALSE</code> to see whether it makes a difference, but remember to check for sensible parameter estimates.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">high_densityBMS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">treeD</span>, data <span class="op">=</span> <span class="va">regimetableD</span>, 
                         model <span class="op">=</span> <span class="st">"BMS"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                         quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                         root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">high_densityOUM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">treeD</span>, data <span class="op">=</span> <span class="va">regimetableD</span>, 
                         starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                         model <span class="op">=</span> <span class="st">"OUM"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                         quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                         root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">high_densityOUMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">treeD</span>, data <span class="op">=</span> <span class="va">regimetableD</span>, 
                          starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                          model <span class="op">=</span> <span class="st">"OUMV"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                          quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                          root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="va">high_densityOUMA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">treeD</span>, data <span class="op">=</span> <span class="va">regimetableD</span>, 
                          starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                          model <span class="op">=</span> <span class="st">"OUMA"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                          quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                          root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span>

<span class="co">#this is a complex model and may not be fit well</span>
<span class="va">high_densityOUMVA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OUwie/man/OUwie.html">OUwie</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">treeD</span>, data <span class="op">=</span> <span class="va">regimetableD</span>, 
                           starting.vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>, 
                           model <span class="op">=</span> <span class="st">"OUMVA"</span>, root.station <span class="op">=</span> <span class="cn">TRUE</span>, 
                           quiet <span class="op">=</span> <span class="cn">TRUE</span>,
                           root.age <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">root.time</span><span class="op">)</span> </code></pre></div>
<p>Now take a look at the AICcs and the parameter estimates as you did for the simple model. Which is the best fit model, and what is the AICc difference from the next best model? What are the parameter estimates and what does that suggest to us about the evolution of fan density in this group?</p>
<div id="using-another-trait-to-define-regimes" class="section level4">
<h4 class="hasAnchor">
<a href="#using-another-trait-to-define-regimes" class="anchor"></a>Using another trait to define regimes</h4>
<p>If you are interested in how a particular discrete state has influenced the evolution of other traits, then you can use <code>OUwie</code> for this too. If the discrete trait is distributed over the tree rather than being confined to particular clades then you can use any ancestral state reconstruction approach to reconstruct the state at each node, and use the different states to define the regimes on the tree. For a great worked example of this approach see Sam Price’s tutorial <a href="http://treethinkers.org/tutorials/state-dependent-diversification-of-traits/">here</a>.</p>
</div>
</div>
<div id="estimate-rates-on-individual-branches" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-rates-on-individual-branches" class="anchor"></a>Estimate rates on individual branches</h2>
<p>Similarly to the relaxed clock models for character change that you discussed and implemented earlier today, it is possible to model change of a particular continuous trait on the phylogeny with potentially different rates on each branch or pulses in rate along individual branches using an MCMC sampler in the function <code>rjmcmc.bm</code> in <code>phytools</code>. For an example of this approach applied to paleontological data see Soul &amp; Benson 2017.</p>
<p><img src="perBranchRate.jpg"></p>
<p><em>Different rates on each branch, from <span class="citation">Soul and Benson (2017)</span> </em></p>
</div>
<div id="multiple-regimes-without-a-priori-shifts" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-regimes-without-a-priori-shifts" class="anchor"></a>Multiple regimes without a priori shifts</h2>
<p>The package <code>surface</code> can be used to estimate OU parameters jointly with regime shift points, using maximum likelihood. It tries to combine branches wherever they are on the tree to those that were experiencing attraction to the same optimum, in this way it can be thought of as a model of convergence. However, be warned, surface has been shown to be biased towards more complex models because the AIC (which is used by the shift point estimation algorithm to assess whether adding or removing new regimes provides a better fit) does not penalise additional parameters enough. It is possible to use a similar approach but substitute AIC for BIC which penalises appropriately in this scenario.</p>
<p>A highly flexible modelling framework was published this year by <span class="citation">Mitov, Bartoszek, and Stadler (2019)</span>. This approach searches for shift points in regime over a phylogeny but allows and gaussian model of evolution to describe the regime, rather than just OU. The appendix of this publication compares the performance of the approach to the performance of <code>surface</code>. A tutorial and the R code to implement the approach is available on github <a href="https://venelin.github.io/PCMfit">here</a>.</p>
</div>
<div id="a-general-model-for-estimating-macroevolutionary-landscapes" class="section level2">
<h2 class="hasAnchor">
<a href="#a-general-model-for-estimating-macroevolutionary-landscapes" class="anchor"></a>A general model for estimating macroevolutionary landscapes</h2>
<p>A fairly new approach that has not yet been widely implemented (so use with caution!), particularly not for paleontological trees, is to use a Fokker-Plank-Kolmogorov (FPK) model. This is a flexible modelling framework that can be used to estimate the shape of a macroevolutionary landscape that has one or more optima, using a parameter called the ‘evolutionary potential’. This framework is distinct from the multi-peak OU models above where switches between macroevolutionary regimes are modelled; instead it fits a model of trait change in a single macroevoluionary regime, but that regime can have multiple optima, and be bounded or unbounded. When there is one peak this model is the same as an OU model. This model can be extended to define many different shapes of macroevolutionary landscape. A tutorial showing how to use R to fit the model can be found on github <a href="https://github.com/fcboucher/BBMV/blob/master/Tutorial-BBMV.md">here</a>.</p>
<p><img src="FPK.jpg"></p>
<p><em>An example of landscapes estimated with FPK</em></p>
</div>
<div id="some-helpful-introductory-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#some-helpful-introductory-resources" class="anchor"></a>Some helpful introductory resources</h2>
<p>Until relatively recently introductory explanations of PCMs were virtually non-existant. Now there are a few, and all come with online versions or supporting resources for applying the methods.</p>
<p>Although it is focussed on anthropology Charles Nunn’s book ‘The comparative approach in evoluionary anthropology and biology’ might be the best true introductory text, low on equations and includes excellent figures. Companion website <a href="https://wiki.duke.edu/display/AnthroTree/The+AnthroTree+Website">AnthroTree</a>.</p>
<p>Luke Harmon’s freely availiable book ‘Phylogenetic Comparative Methods’ covers all the basics then goes into a little more detail.</p>
<p>Modern Phylogenetic Comparative Methods and Their Application in Evolutionary Biology is comprehensive albeit expensive, and is somewhat focussed on approaches relevant to molecular trees although there is a David Bapst chapter at the very end for the paleontologists!</p>
<div id="references-for-other-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#references-for-other-methods" class="anchor"></a>References for other methods</h3>
<p>Levy Models in <span class="citation">Landis and Schraiber (2017)</span> Change at speciation in <span class="citation">Bokma (2002)</span> and <span class="citation">Bokma (2010)</span> Threshold models see chapter 9 of <span class="citation">Harmon (2019)</span> and implementation in <span class="citation">Revell (2014)</span></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-Bokma2002">
<p>Bokma, Folmer. 2002. “Detection of punctuated equilibrium from molecular phylogenies.” <em>Journal of Evolutionary Biology</em> 15: 1048–56.</p>
</div>
<div id="ref-Bokma2010">
<p>———. 2010. “Time, species and separating their effects on trait variance in clades.” <em>Systematic Biology</em> 59 (5): 602–7.</p>
</div>
<div id="ref-Felsenstein1985">
<p>Felsenstein, Joseph. 1985. “Phylogenies and the comparative method.” <em>The American Naturalist</em> 125 (1): 1–15.</p>
</div>
<div id="ref-Gavry2014">
<p>Gavryushkina, Alexandra, David Welch, Tanja Stadler, and Alexei Drummond. 2014. “Bayesian inference of sampled ancestor trees for epidemiology and fossil calibration.” <em>PLoS Computational Biology</em> 10 (12): e1003919. <a href="https://doi.org/10.1371/journal.pcbi.1003919">https://doi.org/10.1371/journal.pcbi.1003919</a>.</p>
</div>
<div id="ref-Hansen1997">
<p>Hansen, Thomas F. 1997. “Stabilising selection and the comparative analysis of adaptation.” <em>Evolution</em> 51 (5): 1342–51.</p>
</div>
<div id="ref-Harmon2019">
<p>Harmon, Luke J. 2019. <em>Phylogenetic Comparative Methods</em>. 1.4 ed.</p>
</div>
<div id="ref-Heath2014">
<p>Heath, Tracy A, John P Huelsenbeck, and Tanja Stadler. 2014. “The fossilized birth–death process for coherent calibration of divergence-time estimates.” <em>Proceedings of the National Academy of Sciences</em> 111 (29): E2957–E2966. <a href="https://doi.org/10.1073/pnas.1319091111">https://doi.org/10.1073/pnas.1319091111</a>.</p>
</div>
<div id="ref-Hunt2012">
<p>Hunt, Gene. 2012. “Measuring rates of phenotypic evolution and the inseparability of tempo and mode.” <em>Paleobiology</em> 38 (3): 351–73. <a href="https://doi.org/10.5061/dryad.c1m60s84">https://doi.org/10.5061/dryad.c1m60s84</a>.</p>
</div>
<div id="ref-Hunt2014">
<p>Hunt, Gene, and Daniel L. Rabosky. 2014. “Phenotypic evolution in fossil species: pattern and process.” <em>Annual Review of Earth and Planetary Sciences</em> 42: 421–41. <a href="https://doi.org/10.1146/annurev-earth-040809-152524">https://doi.org/10.1146/annurev-earth-040809-152524</a>.</p>
</div>
<div id="ref-Landis2017">
<p>Landis, Michael, and Joshua G Schraiber. 2017. “Pulsed evolution shaped modern vertebrate diversity.” <em>Proceedings of the National Academy of Sciences of the United States of America</em> 114 (50): 13224–9. <a href="https://doi.org/10.1101/151175">https://doi.org/10.1101/151175</a>.</p>
</div>
<div id="ref-Louca2019">
<p>Louca, Stilianos, and Matthew W Pennell. 2019. “Phylogenies of extant species are consistent with an infinite array of diversification histories.” <em>bioRxiv</em>. <a href="https://doi.org/http://dx.doi.org/10.1101/719435.">https://doi.org/http://dx.doi.org/10.1101/719435.</a></p>
</div>
<div id="ref-Mitov2019">
<p>Mitov, Venelin, Krzysztof Bartoszek, and Tanja Stadler. 2019. “Automatic generation of evolutionary hypotheses using mixed Gaussian phylogenetic models.” <em>Proceedings of the National Academy of Science</em> 116 (34): 16921–6.</p>
</div>
<div id="ref-Nunn2011">
<p>Nunn, Charles L. 2011. <em>The comparative approach in evolutionary anthropology and biology</em>. 1st ed. Chicago: Univeristy of Chicago Press.</p>
</div>
<div id="ref-Nunn2001">
<p>Nunn, Charles L., and Robert A. Barton. 2001. “Comparative methods for studying primate adaptation and allometry.” <em>Evolutionary Anthropology</em> 10 (3): 81–98. <a href="https://doi.org/10.1002/evan.1019">https://doi.org/10.1002/evan.1019</a>.</p>
</div>
<div id="ref-Revell2014">
<p>Revell, Liam J. 2014. “Ancestral character estimation under the threshold model from quantitative genetics.” <em>Evolution</em> 68: 743–59.</p>
</div>
<div id="ref-Revell2010">
<p>Revell, L J. 2010. “Phylogenetic signal and linear regression on species data.” <em>Methods in Ecology and Evolution</em> 1 (4): 319–29. <a href="https://doi.org/10.1111/j.2041-210X.2010.00044.x">https://doi.org/10.1111/j.2041-210X.2010.00044.x</a>.</p>
</div>
<div id="ref-Silvestro2015b">
<p>Silvestro, Daniele, Anna Kostikova, Glenn Litsios, Peter B. Pearman, and Nicolas Salamin. 2015. “Measurement errors should always be incorporated in phylogenetic comparative analysis.” <em>Methods in Ecology and Evolution</em> 6 (3): 340–46. <a href="https://doi.org/10.1111/2041-210X.12337">https://doi.org/10.1111/2041-210X.12337</a>.</p>
</div>
<div id="ref-Slater2012">
<p>Slater, Graham J, Luke J Harmon, and Michael E Alfaro. 2012. “Integrating fossils with molecular phylogenies improves inference of trait evolution.” <em>Evolution</em> 66 (12): 3931–44. <a href="https://doi.org/10.5061/dryad.q96d7">https://doi.org/10.5061/dryad.q96d7</a>.</p>
</div>
<div id="ref-Soul2017">
<p>Soul, Laura C., and Roger B J Benson. 2017. “Developmental mechanisms of macroevolutionary change in the tetrapod axis: A case study of Sauropterygia.” <em>Evolution</em> 71 (5): 1164–77. <a href="https://doi.org/10.1111/evo.13217">https://doi.org/10.1111/evo.13217</a>.</p>
</div>
<div id="ref-Soul2015">
<p>Soul, Laura C, and Matt Friedman. 2015. “Taxonomy and phylogeny can yield comparable results in comparative palaeontological analyses.” <em>Systematic Biology</em> 64 (4): 608–20.</p>
</div>
<div id="ref-Wright2017">
<p>Wright, David F. 2017. “Phenotypic Innovation and Adaptive Constraints in the Evolutionary Radiation of Palaeozoic Crinoids.” <em>Scientific Reports</em> 7 (1): 1–10. <a href="https://doi.org/10.1038/s41598-017-13979-9">https://doi.org/10.1038/s41598-017-13979-9</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
