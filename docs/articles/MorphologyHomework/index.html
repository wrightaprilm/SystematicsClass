<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MorphologyHomework • SystematicsClass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="MorphologyHomework">
<meta property="og:description" content="SystematicsClass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">SystematicsClass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/00_Basics_of_R/index.html">R Reminder</a>
    </li>
    <li>
      <a href="../../articles/01_homology_assignment/index.html">Morphological Homology Assignment</a>
    </li>
    <li>
      <a href="../../articles/02_molecular_homology/index.html">Molecular Homology Assignment</a>
    </li>
    <li>
      <a href="../../articles/03_massive_homology/index.html">Genome-Scale Homology</a>
    </li>
    <li>
      <a href="../../articles/04_ParsimonyAndModels/index.html">PAUP, parsimony, and nucletoide substitution models</a>
    </li>
    <li>
      <a href="../../articles/06_Bayes_and_MCMC/index.html">Introduction to MCMC using RevBayes</a>
    </li>
    <li>
      <a href="../../articles/07_molecular_data/index.html">Nucleotide substitution models</a>
    </li>
    <li>
      <a href="../../articles/08_Discrete_Morphology/index.html">Discrete morphology - Models and Tree Inference</a>
    </li>
    <li>
      <a href="../../articles/09_Partitioned_data/index.html">Partitioned data analysis</a>
    </li>
    <li>
      <a href="../../articles/10_Molecular_Clock/index.html">Tripartite Model 2 - Clock Models for Character Data</a>
    </li>
    <li>
      <a href="../../articles/11_FBD/RB_Total_Evidence_Tutorial.html">RevBayes Total Evidence Tree Estimation</a>
    </li>
    <li>
      <a href="../../articles/13_Comparative_Methods/index.html">Phylogenetic Comparative Methods for Paleobiology</a>
    </li>
    <li>
      <a href="../../articles/14_biogeography/index.html">Introduction to Phylogenetic Models of Discrete Biogeography</a>
    </li>
    <li>
      <a href="../../articles/15_Final/index.html">FinalExam</a>
    </li>
    <li>
      <a href="../../articles/LCalc/LikelihoodCalc.html">LikelihoodCalc</a>
    </li>
    <li>
      <a href="../../articles/ModelsHomework/index.html">Models Homework</a>
    </li>
    <li>
      <a href="../../articles/MolecularModelsHomework/index.html">MolecularModelsHomework</a>
    </li>
    <li>
      <a href="../../articles/MorphologyHomework/index.html">MorphologyHomework</a>
    </li>
    <li>
      <a href="../../articles/PaupHomework/index.html">PAUPHomework</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MorphologyHomework</h1>
                        <h4 data-toc-skip class="author">April Wright</h4>
            
            <h4 data-toc-skip class="date">3/15/2022</h4>
      
      
      <div class="hidden name"><code>index.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="choose-your-own-adventure">Choose Your Own Adventure<a class="anchor" aria-label="anchor" href="#choose-your-own-adventure"></a>
</h2>
<p>Pick Two. Do it and answer the questions.</p>
</div>
<div class="section level2">
<h2 id="lognormally-distributed-among-character-rate-variation">Lognormally-distributed among-character rate variation<a class="anchor" aria-label="anchor" href="#lognormally-distributed-among-character-rate-variation"></a>
</h2>
<p>As we discussed, there is reason to believe a lognormal distribution may fit morphological data better than a gamma. RevBayes makes it very natural to discretize <em>any</em> distribution you might like to work with.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">rates_morpho</span> <span class="op">:=</span> <span class="fu">fnDiscretizeDistribution</span><span class="op">(</span> <span class="fu">dnLognormal</span><span class="op">(</span><span class="fu">ln</span><span class="op">(</span><span class="va">alpha_morpho</span><span class="op">)</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fl">4</span> <span class="op">)</span></code></pre></div>
<p>Can you figure out which line you might replace with this code?</p>
<blockquote>
<p>Create a copy of your previous <code>Rev</code> script, and call it <em>mcmc_MkLog.Rev</em>. You will need to modify the <code>Rev</code> code provided in this section in this file.</p>
</blockquote>
<p>Make this change in your duplicated copy, and change the names of your output files to indicate that this is estimation uses a lognormal distribution. Run your new Rev script.</p>
<div class="section level3">
<h3 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Compare an estimation with the Gamma-distributed among character rate variaiton (ACRV) to the lognormal ACRV. Are they the same? Does the likelihood, posterior, or tree length change?</p></li>
<li><p>Plot the Gamma and Lognormal distributions in R (See the lesson for examples on doing this). Do they look the same? How do they differ? What do you think this means for the underlying biology we’re trying to model?</p></li>
<li><p>Try summarizing the tree and viewing in Fig Tree. Does it differ from the Gamma-distributed tree?</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="ascertainment-bias">Ascertainment Bias<a class="anchor" aria-label="anchor" href="#ascertainment-bias"></a>
</h2>
<p>As discussed earlier in the section Ascertainment_Bias, we also need to correct for ascertainment bias.</p>
<blockquote>
<p>Create a copy of your previous <code>Rev</code> script, and call it <em>mcmc_Mkv.Rev</em>. You will need to modify the <code>Rev</code> code provided in this section in this file.</p>
</blockquote>
<p>In <code>RevBayes</code> it is actually very simple to add a correction for ascertainment bias. You only need to set the option <code>coding="variable"</code> in the <code>dnPhyloCTMC</code>. Coding specifies what type of ascertainment bias is expected. We are using the <code>variable</code> correction, as we have no invariant character in our matrix. If we also lacked parsimony non-informative characters, we would use the coding <code>informative</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phyMorpho</span> <span class="op">~</span> <span class="fu">dnPhyloCTMC</span><span class="op">(</span>tree<span class="op">=</span><span class="va">phylogeny</span>, siteRates<span class="op">=</span><span class="va">rates_morpho</span>, Q<span class="op">=</span><span class="va">Q_morpho</span>, type<span class="op">=</span><span class="st">"Standard"</span>, coding<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Compare this estimation with one without correcting for ascertainment bias. Are they the same? Does the likelihood, posterior, or tree length change?</p></li>
<li><p>Try both the “variable” and “informative” corrections. Which do you think is correct?</p></li>
<li><p>Try summarizing the tree and viewing in Fig Tree. Does it differ from the ascertainment bias non-corrected tree?</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="relaxing-character-state-symmetry">Relaxing Character State Symmetry<a class="anchor" aria-label="anchor" href="#relaxing-character-state-symmetry"></a>
</h2>
<p>The Mk model makes a number of assumptions, but one that may strike you as particularly unrealistic is the assumption that characters are equally likely to change from any one state to any other. That means that a trait is as likely to be gained as lost. While this may hold true for some traits, we expect that it may be untrue for many others.</p>
<p>RevBayes has functionality to allow us to relax this assumption. We do this by specifying a beta prior on state frequencies. Stationary frequencies impact how likely we are to see changes in a character. For example, it may be very likely, in a character, to change from 0 to 1. But if the frequency of 0 is very low, we will still seldom see this change.</p>
<p>We can think of a Q matrix as looking like so:</p>
<p><span class="math display">\[Q = \begin{pmatrix} -\mu_0\pi0 &amp; \mu_{01}\pi0 \\
\mu_{10}\pi1 &amp; -\mu_1\pi1  &amp;\\
\end{pmatrix} \mbox{  ,}\]</span></p>
<p>In which the probability of changing states depends not solely on the transition probability, but also the frequency of the starting state. For example, if we have a rare character state, we do not expect to see many transitions from the rare state to another. <span class="math inline">\(\pi\)</span> is the value chosen to represent state frequency commonly in phylogenetic models.</p>
<p>We can exploit the relationship between state frequencies and observed changes to allow for variable Q-matrices across characters. To do this, we generate a beta distribution on state frequencies, and use the state frequencies from that distribution to generate a series of Q-matrices used to evaluate our data <span class="citation">[@Pagel2004, @Nylander2004, @Wright2016]</span>.</p>
<p>This type of model is called a <strong>mixture model</strong>. There are assumed to be subdivisions in the data, which may require different parameters (in this case, state frequencies). These subdivisions are not defined <em>a priori</em>. This model has previously been shown to be effective for a range of empirical and simulated datasets [Wright2016].</p>
<div class="section level3">
<h3 id="modifying-the-rev-script">Modifying the Rev-script<a class="anchor" aria-label="anchor" href="#modifying-the-rev-script"></a>
</h3>
<blockquote>
<p>Make a copy of the Rev script you made earlier. Call it <code>mcmc_mk_discretized.Rev</code>. This new script will contain the new model parameters and models.</p>
</blockquote>
<p>We will use a discretized beta distribution to place a prior on the state frequencies. The beta distribution has two parameters, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. These two parameters specify the shape of the distribution. State frequencies will be evaluated according to this distribution, in the same way that rate variation is evaluated according to the gamma distribution. The discretized distribution is split into multiple classes, each with it’s own set of frequencies for the 0 and 1 characters. The number of classes can vary; we have chosen 4 for tractability. Note that we need to make sure that this discretization results in a symmetric model, therefore we will use only one parameter for the beta distribution: <code>beta_scale</code> such that <span class="math inline">\(\alpha = \beta\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_cats</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">beta_scale</span> <span class="op">~</span> <span class="fu">dnLognormal</span><span class="op">(</span> <span class="fl">0.0</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fl">0.587405</span> <span class="op">)</span>
<span class="fu">moves.append</span><span class="op">(</span> <span class="fu">mvScale</span><span class="op">(</span><span class="va">beta_scale</span>, lambda<span class="op">=</span><span class="fl">1</span>, weight<span class="op">=</span><span class="fl">5.0</span> <span class="op">)</span> <span class="op">)</span></code></pre></div>
<p>Above, we initialized the number of categories, the parameters of the beta distribution, and the moves on these parameters.</p>
<p>Next, we set the categories to each represent a quadrant of the beta distribution specified by <code>beta_scale</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cats</span> <span class="op">:=</span> <span class="fu">fnDiscretizeBeta</span><span class="op">(</span><span class="va">beta_scale</span>, <span class="va">beta_scale</span>, <span class="va">num_cats</span><span class="op">)</span></code></pre></div>
<p>If you were to print the <code>cats</code> variable, you would see a list of state frequencies like so:</p>
<pre><code>[ 0.011, 0.236, 0.764, 0.989 ]</code></pre>
<p>Using these state frequencies, we will generate a new vector of Q-matrices. Because we are varying the state frequencies, we must use a Q-matrix generation function that allows for state frequencies to vary as a parameter. We will, therefore, use the <code>fnF81</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">cats.size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">{</span>
    <span class="va">Q</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">:=</span> <span class="fu">fnF81</span><span class="op">(</span><span class="fu">simplex</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">cats</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">cats</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Additionally, in RevBayes we need to specify the probabilities that a site evolves according to one of the Q-matrices. For this model the probabilities must be equal because we need to guarantee that the model is symmetric. Thus, we use a <code>simplex</code> function to create a vector that sums to 1.0.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matrix_probs</span> <span class="op">&lt;-</span> <span class="fu">simplex</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">num_cats</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="questions-1">Questions<a class="anchor" aria-label="anchor" href="#questions-1"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Look at the output in tracer. There are several variables added to the trace. What are they and what do they mean?</p></li>
<li><p>What do you think this model means for the underlying biology we’re trying to model?</p></li>
<li><p>Try summarizing the tree and viewing in Fig Tree. Does it differ from the JC model tree?</p></li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
